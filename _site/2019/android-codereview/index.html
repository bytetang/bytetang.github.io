<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>tangchiech blog - Android Code Review</title>
  <link rel="shortcut icon" href="/assets/images/favicon.ico">
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="alternate" type="application/rss+xml" title="My Blog" href="/feed.xml">
  <link rel="stylesheet" href="/assets/css/highlight.css">
</head>
<body>

  <nav class="main-nav">
    
        <a href="/"> <span class="arrow">←</span> Home </a>
    

    
        <a href="/about">About </a>
    
    <a class="cta" href="/feed.xml">Subscribe</a>
</nav>

  

  <section id="wrapper" class="">
    <article class="post">
    <header>
        <h1>Android Code Review</h1>
        <h2 class="headline">February 27, 2019</h2>
    </header>
    <section id="post-body">
        <h2 id="空指针篇">空指针篇</h2>

<p>1、字符串比较，将常量放在前面</p>

<p>case:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DOMESTIC</span> <span class="o">=</span> <span class="s">"1"</span>
<span class="n">domestic</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">DOMESTIC</span><span class="o">);</span>
</code></pre></div></div>

<p>修正为：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DOMESTIC</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">domestic</span><span class="o">);</span>
</code></pre></div></div>

<p>2、初始化你的默认值</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FilterItemVM</span> <span class="n">fiterVM</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterItemVM</span><span class="o">();</span>
<span class="n">fiterVM</span><span class="o">.</span><span class="na">filterType</span> <span class="o">=</span> <span class="n">FilterType</span><span class="o">.</span><span class="na">ECOMOMY</span><span class="o">;</span>
</code></pre></div></div>

<blockquote>
  <p>页面间对象传参在数据不完整的情况下崩溃，多数情况下是因为接收到了空的传参未处理直接调用，建议不要依赖调用方的”安全”使用。</p>
</blockquote>

<p>3、返回空列表替代null</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">List</span><span class="o">&lt;</span><span class="n">IBULocale</span><span class="o">&gt;</span> <span class="nf">getAllLocale</span><span class="o">(){</span>
    <span class="o">...</span>
    <span class="k">if</span><span class="o">(</span><span class="n">localeList</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">IBULocacle</span><span class="o">&gt;();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<blockquote>
  <p>return参数在后续会被使用，如果难以保证调用的地方都安全的调用了，最好还是不要返回null。</p>
</blockquote>

<p>4、使用判空的工具类</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//字符换判空</span>
<span class="n">android</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">TextUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span>
<span class="c1">//集合判空</span>
<span class="n">com</span><span class="o">.</span><span class="na">ctrip</span><span class="o">.</span><span class="na">ibu</span><span class="o">.</span><span class="na">utility</span><span class="o">.</span><span class="na">ListUtil</span><span class="o">.</span><span class="na">hasItem</span><span class="o">()|</span><span class="n">isNullOrEmpty</span><span class="o">()</span>
</code></pre></div></div>

<blockquote>
  <p>使用工具类的好处是，容易养成习惯并且避免取反等逻辑错写出现</p>
</blockquote>

<p>5、使用String.valueOf(Object) 替代 Object.toString()</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">..;</span>
<span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"TAG"</span><span class="o">,</span><span class="n">user</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</code></pre></div></div>

<p>更改为：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"TAG"</span><span class="o">,</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">user</span><span class="o">))</span>
</code></pre></div></div>

<p>6、你的Deeplink/Router/CMPC每个参数都应该考虑空的情况</p>

<p>契约类型，传入的参数较为自由，组合也比较多。即使规范好了调用方式，也可能存在非法的传入。请考虑每个参数为空的情况。</p>

<p>7、使用context和activity的引用时先判空</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">network</span><span class="o">.</span><span class="na">OnSuccess</span><span class="o">(){</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">getActivity</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">getActivity</span><span class="o">().</span><span class="na">doSomething</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<blockquote>
  <p>activity被回收后调用容易引起内存泄漏，相对于找内存泄漏，空安全也可能让内存泄漏不Crash。</p>
</blockquote>

<h2 id="类型转换篇">类型转换篇</h2>

<p>1、注意你的String转Number的方法</p>

<p>如：Double.valueOf(String),String.parseDouble(String) ，传入的类型如果不是数字格式的就会出错。做好合法性校验，甚至是trycatch。</p>

<p>正确如下：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">gatewayTime</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
            <span class="kt">double</span> <span class="n">gatewayTimeDouble</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">gatewayTime</span><span class="o">);</span>
            <span class="n">serverCallParams</span><span class="o">.</span><span class="na">addCurrentServerCallExtraInfos</span><span class="o">(</span><span class="s">"gatewayTime"</span><span class="o">,</span> <span class="n">gatewayTimeDouble</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">ignore</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>2、不要信任系统API返回的数据。转换操作一律trycatch.</p>

<p>错误示例:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//获取网络代理的状态</span>
<span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"http.proxyPort"</span><span class="o">))</span>
</code></pre></div></div>
<p>这里返回的不一定是数字，可能的原因是安卓碎片太严重，有些厂商上的api就说不定了。</p>

<p>3、做好类型判断后再转换</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">params</span> <span class="k">instanceof</span> <span class="n">CoordinatorLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">)</span> <span class="o">{</span>
   <span class="o">((</span><span class="n">CoordinatorLayout</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">)</span> <span class="n">params</span><span class="o">).</span><span class="na">setBehavior</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>kotlin的话使用is关键字</p>
</blockquote>

<h2 id="线程安全篇">线程安全篇</h2>

<p>1、你的单例安全吗</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DBHelper</span> <span class="n">instance</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">DBHelper</span> <span class="nf">getDBHelper</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DBHelper</span><span class="o">()</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>在多线程的情况下dbHelper == null就不是一定成立的了，这就可能导致创建了多个实例出来，违背了单例的本意。</p>

<blockquote>
  <p>这里可以voliate 你的dbHelper，让这个变量对其他的线程可见。或者同步整个获取单例的操作，但是在频繁调用的情况下注意性能开销。</p>
</blockquote>

<p>线程安全单例示例：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Object</span> <span class="n">mutex</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">();</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">IBULocaleManager</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">IBULocaleManager</span> <span class="n">result</span> <span class="o">=</span> <span class="n">instance</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="n">mutex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">instance</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IBULocaleManager</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span> 
</code></pre></div></div>

<blockquote>
  <p>在getInstance()比较频繁情况下，多数是命中非空直接实例的， 如果对整个getInstance方法加锁就会影响性能，这里只在为空需要初始化对象的时候同步和校验，大大降低了对性能的影响。</p>
</blockquote>

<p>2、隐藏你可以私有的方法和变量</p>

<p>如果你的方法不是一个线程安全的方法，且都是内部自己在调用（Java里面指在同一个类），请直接私有掉方法/变量，避免暴露出去让调用方引入了崩溃。</p>

<p>3、发现死锁</p>

<ul>
  <li>当心嵌套锁，</li>
</ul>

<p>如下：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>


<span class="kd">private</span> <span class="kd">static</span> <span class="n">Object</span> <span class="n">lock1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">();</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">Object</span> <span class="n">lock2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">();</span>
 
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Task</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="n">lock1</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">lock2</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">lock1</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>获取锁设置超时</li>
</ul>

<p>多数情况下ReentrantLock可以替换synchronized，获取锁时设置一个超时时间，降低死锁风险。</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">lock1</span><span class="o">.</span><span class="na">tryLock</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">))</span> <span class="o">{}</span>
    <span class="o">}</span>
 <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>正确释放锁
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span><span class="o">{</span>
  <span class="k">do</span><span class="o">...</span>
<span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">){</span>
  <span class="c1">//lock.unlock() 不要在这里释放锁，try block里面可能也没有释放，而这里只处理异常的场景</span>
<span class="o">}</span><span class="k">finally</span><span class="o">{</span>
  <span class="c1">//这里释放锁最佳</span>
  <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">()</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>4、集合遍历要当心</p>

<p>如果你没有选择线程安全的集合类（如CopyOnWriteArrayList)，那集合操作的地方都要当心了。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="o">...</span>
<span class="kd">class</span> <span class="nc">RunableA</span> <span class="kd">implements</span> <span class="n">Runable</span><span class="o">{</span>
    <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
        <span class="n">list</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="k">new</span> <span class="n">Random</span><span class="o">().</span><span class="na">next</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">RunableB</span> <span class="kd">implements</span> <span class="n">Runable</span><span class="o">{</span>
    <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">str:</span><span class="n">list</span><span class="o">{</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
            <span class="o">...</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>正确写法,操作集合的时候加同步：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">synchronized</span><span class="o">(</span><span class="n">list</span><span class="o">){</span>
    <span class="n">list</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="k">new</span> <span class="n">Random</span><span class="o">().</span><span class="na">next</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">));</span>
<span class="o">}</span>

<span class="kd">synchronized</span><span class="o">(</span><span class="n">list</span><span class="o">){</span>
    <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">str:</span><span class="n">list</span><span class="o">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<blockquote>
  <p>为了保证锁的正确性和不必要的性能开销，最好<b>集合对象来作为对象锁</b>，避免使用this这种对象锁，匿名内部类的话锁的就可能不是一个对象了，锁也是无效的。</p>
</blockquote>

<p>5、线程的取消和关闭</p>

<p>这是个容易被忽视但是很重要的一点，如果你的线程不能响应错误的中断或者在任务结束的时候没有正确的关闭它，那么他们一直运转下去，资源开销等也一直存在，间接引发其他问题。</p>

<ul>
  <li>ExecuteService shutdown()</li>
</ul>

<p>正确的stop</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>  
    <span class="k">try</span> <span class="o">{</span>  
        <span class="n">exec</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span> 
        <span class="n">exec</span><span class="o">.</span><span class="na">awaitTermination</span><span class="o">(</span><span class="n">TIMEOUT</span><span class="o">,</span> <span class="n">UNIT</span><span class="o">);</span>  
    <span class="o">}</span>  
<span class="o">}</span>  
</code></pre></div></div>
<blockquote>
  <p>需要区分shudown()和shutdownNow()的区别，如果你已经submit的task还想继续得到执行请不要使用和shutdownNow。</p>
</blockquote>

<ul>
  <li>“毒丸”/”标志位”中断</li>
</ul>

<p>投放”毒丸”</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">canceled</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</code></pre></div></div>

<p>遇到毒丸放弃</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span><span class="o">(!</span><span class="n">canceled</span><span class="o">){</span>
    <span class="n">doTask</span><span class="o">()</span>
<span class="o">}</span>
</code></pre></div></div>
<ul>
  <li>Future cancle</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Future</span> <span class="n">future</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="k">new</span> <span class="n">Task</span><span class="o">());</span>
<span class="k">try</span> <span class="o">{</span>
   <span class="c1">// 可能抛出异常</span>
   <span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
    <span class="c1">//终止任务的执行</span>
    <span class="n">future</span><span class="o">.</span><span class="na">cancel</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="android其他篇">Android其他篇</h2>

<p>1、数据库的操作</p>

<ul>
  <li>确保操作的helper类是单例的并考虑了线程安全问题。</li>
  <li>查询的时候尽量使用索引</li>
  <li>避免DB过大，会引入较多的系统性问题</li>
</ul>

<p><br />
2、混淆类问题</p>

<ul>
  <li>接入第三方库或者底层库的时候要阅读和关注混淆规则的接入</li>
  <li>反射调用的类/方法检查不能混淆，引发导致classnotfound</li>
</ul>

<p><br />
3、注意字符串拼接性能</p>

<p>避免大量字符串”+”的操作</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"start"</span><span class="o">;</span>
<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span> <span class="o">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
    <span class="n">str</span> <span class="o">=</span> <span class="n">str</span> <span class="o">+</span> <span class="s">"trip"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<blockquote>
  <p>建议使用StringBuiler/StringBuffer等完成</p>
</blockquote>

<p>4、注意字符串分隔性能</p>

<p>避免在会被频繁调用的方法中使用以下方式分隔字符串</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"hello-world"</span><span class="o">;</span>
<span class="n">String</span><span class="o">[]</span> <span class="n">results</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"-"</span><span class="o">);</span>
</code></pre></div></div>
<p>请使用性能更好的<code class="highlighter-rouge">indexOf()+substring(from+1, to)</code>组合</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"hello-world"</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">from</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="sc">'-'</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">to</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="sc">'-'</span><span class="o">,</span> <span class="n">from</span><span class="o">+</span><span class="mi">1</span><span class="o">);</span>
<span class="n">String</span> <span class="n">brown</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">from</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">to</span><span class="o">);</span>
</code></pre></div></div>

<p>5、别再制造Context的内存泄漏了！</p>

<p>你的Context对象还在被单例或者静态对象持有吗？如下：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">LeakObject</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="n">LeakObject</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LeakObject</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
<span class="o">}</span>

</code></pre></div></div>

<p>LeakObject对象的生命周期的常驻的，不同于Activity的Context的生命周期，Context已经回收了可能LeakObject还在使用。这种场景应该传入 getApplicationContext()</p>

    </section>
</article>
<footer id="post-meta" class="clearfix">
    <a href="http://twitter.com/YourTwitterUsername">
        <img class="avatar" src="/assets/images/avatar.png">
        <div>
            <span class="dark">Morse</span>
            <span>Blogging about Android & Java tech</span>
        </div>
    </a>

    <section id="sharing">
        <a class="twitter" href="https://twitter.com/intent/tweet?text=http://javmorse.github.io/2019/android-codereview/ - Android Code Review by @YourTwitterUsername"><span class="icon-twitter"> Tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>
    </section>
</footer>

<!-- Disqus comments -->


<!-- Archive post list -->





  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="/assets/js/main.js"></script>
  <script src="/assets/js/highlight.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', '', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>



